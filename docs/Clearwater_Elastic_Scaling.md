The core Clearwater nodes have the ability to elastically scale; in other words, you can grow and shrink your deployment on demand, without disrupting calls or losing data.

This page explains how to use this elastic scaling function when using a deployment created through the automated install process.

## Before scaling your deployment

Before scaling up or down, you should decide how many each of Bono, Sprout, Homestead and Homer nodes you need (i.e. your target size). This should be based on your call load profile and measurements of current systems, though based on experience we recommend scaling up a tier of a given type (sprout, bono, etc.) when the average CPU utilization within that tier reaches ~60%. The [Deployment Sizing Spreadsheet](http://www.projectclearwater.org/technical/clearwater-performance/) may also provide useful input.

Having determined your new cluster size, you need to decide which of the following two scale-up methods you are going to use.  The quick method is completely safe when scaling up your cluster, but, when scaling down, timer events programmed before the scale operation started may be lost.  This may lead to:

* Incomplete billing records generated by Ralf
* Missing NOTIFY messages on registration expiry
* Authentication vectors not being invalidated if the client never sends an authenticated REGISTER message.

On the other hand, the slow method guarantees that timers are persisted over the scale operation.  Despite the limitations, the quick method is simpler and is sufficient for testing deployments.  Unless you are using your deployment for hosting a live service, we recommend the quick method.

## Performing the resize (Quick Method)

To resize your deployment, run:

    knife deployment resize -E <env> --sprout-count <n> --bono-count <n> --homer-count <n> --homestead-count <n>

Where the `<n>` values are how many nodes of each type you need.  Once this command has completed, the resize operation has completed and any nodes that are no longer needed will have been terminated.

## Performing the resize (Slow Method)

To resize the deployment:

* Run 

        knife deployment resize -E <env> --sprout-count <n> --bono-count <n> --homer-count <n> --homestead-count <n> --start

    where the `<n>` values are as they were in the basic method.

* Wait for the session refresh time to pass.
* Run

        knife deployment resize -E <env> --finish

Once this last command has completed, the resize operation is complete and any nodes that are no longer needed will have been terminated.
